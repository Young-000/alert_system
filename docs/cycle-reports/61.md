# Cycle 61: P4-3 Frontend -- Social Route Community

**Date**: 2026-03-02
**Branch**: p4-3-social
**Agent**: FE Developer

## Summary

Implemented the frontend for P4-3 Social Route Community (Anonymous Route Neighbors). This adds an anonymous, route-based micro-community layer where users who share 2+ common checkpoints can see aggregated neighbor stats and exchange short anonymous tips per checkpoint.

## Changes

### E1: API Client + Types + React Query Hooks
- **commute-api.client.ts**: Added 7 community types (`NeighborStatsResponse`, `CommunityTip`, `TipsListResponse`, `CreateTipRequest`, `CreateTipResponse`, `ReportTipResponse`, `HelpfulTipResponse`) and 5 API methods (`getNeighborStats`, `getCheckpointTips`, `createTip`, `markHelpful`, `reportTip`)
- **query-keys.ts**: Added `community` key group with `neighbors` and `tips` keys
- **use-community-query.ts**: Created 5 hooks (`useNeighborStats`, `useCheckpointTips`, `useCreateTip`, `useMarkHelpful`, `useReportTip`) following existing React Query patterns
- **index.ts (api)**: Re-exported all community types
- **__mocks__/infrastructure/api/index.ts**: Added community mock data and methods

### E2: NeighborSection Component
- Displays neighbor count and average commute time comparison
- Shows "insufficient data" message when < 3 neighbors
- Hidden when loading, error, or no route (optional, non-intrusive)
- Color-coded diff indicator (green=faster, amber=slower)
- Integrated into HomePage below CommuteSection

### E3: CheckpointTips Component
- Lists tips for a checkpoint with loading/error/empty states
- Renders TipCard for each tip with helpful count and report button
- Shows tip form for logged-in users
- Handles rate limit (429) error from API
- Shows eligibility message for users with < 3 sessions

### E4: TipForm Component
- Character counter (max 100)
- Submit on click or Enter key (Shift+Enter for newline)
- Disabled state when empty, over limit, submitting, or rate-limited
- Eligibility gate for users with < 3 sessions
- Clears input after successful submission

### E5: TipCard Component
- Displays tip content, relative time, helpful count
- Helpful toggle button with active state
- Report flow with inline confirmation (confirm/cancel)
- Already-reported disabled state
- Korean relative time formatting (방금 전, N분 전, N시간 전, N일 전)

### E6: CSS Styles
- Created `community.css` with subtle, non-intrusive design
- Uses existing CSS custom properties (--bg-card, --border, --primary, etc.)
- Mobile-first responsive with 360px breakpoint
- Imported in index.css

## Test Results

| Check | Result |
|-------|--------|
| TypeScript (`tsc --noEmit`) | Pass (0 errors) |
| ESLint (`--max-warnings=0`) | Pass (0 warnings) |
| Build (`vite build`) | Pass |
| Tests (`vitest run`) | **594 passed** (45 new) |

### New Test Breakdown
- NeighborSection.test.tsx: 10 tests
- TipCard.test.tsx: 12 tests
- TipForm.test.tsx: 13 tests
- CheckpointTips.test.tsx: 10 tests
- **Total: 45 new tests**

## Files Created
- `frontend/src/infrastructure/query/use-community-query.ts`
- `frontend/src/presentation/pages/home/NeighborSection.tsx`
- `frontend/src/presentation/pages/home/NeighborSection.test.tsx`
- `frontend/src/presentation/pages/home/CheckpointTips.tsx`
- `frontend/src/presentation/pages/home/CheckpointTips.test.tsx`
- `frontend/src/presentation/pages/home/TipCard.tsx`
- `frontend/src/presentation/pages/home/TipCard.test.tsx`
- `frontend/src/presentation/pages/home/TipForm.tsx`
- `frontend/src/presentation/pages/home/TipForm.test.tsx`
- `frontend/src/presentation/styles/pages/community.css`

## Files Modified
- `frontend/src/infrastructure/api/commute-api.client.ts` (types + methods)
- `frontend/src/infrastructure/api/index.ts` (re-exports)
- `frontend/src/infrastructure/query/query-keys.ts` (community keys)
- `frontend/src/presentation/pages/home/HomePage.tsx` (NeighborSection integration)
- `frontend/src/presentation/pages/home/index.ts` (barrel exports)
- `frontend/src/presentation/styles/index.css` (community.css import)
- `frontend/src/__mocks__/infrastructure/api/index.ts` (community mocks)

## Privacy Compliance
- No user IDs, names, or any PII exposed in any component or API call
- Tips are fully anonymous -- no author information shown
- Neighbor stats show only aggregated counts and averages
- Report tracking uses server-side user context only (isReportedByMe boolean)

## Design Decisions
- NeighborSection returns null on loading/error (subtle optional feature, not a blocker)
- TipCard uses inline confirm/cancel for report (no modal -- lightweight interaction)
- TipForm clears on submit and handles 429 rate limit gracefully
- All components follow existing plain CSS patterns (not Tailwind)
