# Cycle 59: P4-2 Frontend — Regional Insights Page

## Summary
Implemented the complete frontend for the Regional Insights feature (P4-2), including API client types, React Query hooks, InsightsPage with accordion region cards, PeakHoursChart, MyComparisonSection, bottom navigation integration, CSS styles, and 37 new tests.

## Completed

### E1: API Client + Types + React Query Hooks
- Added 7 insight types to `commute-api.client.ts`: `RegionSummary`, `RegionDetail`, `RegionTrend`, `PeakHoursData`, `MyComparison`, `RegionsListResponse`, `PaginationMeta`
- Added 5 API methods: `getRegions()`, `getRegionById()`, `getRegionTrends()`, `getRegionPeakHours()`, `getMyComparison()`
- Created `use-insights-query.ts` with 5 hooks: `useRegions`, `useRegionDetail`, `useRegionTrends`, `useRegionPeakHours`, `useMyComparison`
- Added `insights` query keys to `query-keys.ts`
- Added all mock types and mock implementations to `__mocks__/infrastructure/api/index.ts`

### E2-E5: UI Components
- **InsightsPage** (`/insights`): Header with title/subtitle, sort dropdown, region list with accordion, loading/error/empty states
- **RegionCard**: Shows region name, avg duration, user count, session count, week trend badge with color coding, confidence indicator based on user count (high/medium/low), expandable with inline detail
- **RegionDetailPanel**: Fetches region detail + peak hours on expand, shows stats and trends with badges
- **PeakHoursChart**: CSS-only horizontal bar chart with 24 bars, peak hour highlighted in accent color, major hour labels
- **MyComparisonSection**: Auth-gated comparison, login CTA for guests, route setup CTA for users without data, bar chart comparison with user vs regional avg, color-coded diff result

### E6: Navigation Integration
- Added `/insights` route to `App.tsx` with lazy loading
- Added `InsightsIcon` SVG component to `BottomNavigation.tsx`
- Added "인사이트" tab to bottom navigation with chart icon
- Added to idle preload and prefetch map

### E7: CSS Styles
- Created `insights.css` with all styles (350+ lines)
- Mobile-first responsive design with 640px breakpoint
- Uses existing CSS custom properties (`--bg-card`, `--border`, `--primary`, etc.)
- Imported in `index.css`

### E8: Tests — 37 new tests
- **RegionCard.test.tsx** (14 tests): name, stats, trend color logic (improving/worsening/stable), confidence levels, expand/collapse, aria-expanded
- **PeakHoursChart.test.tsx** (6 tests): chart rendering, bar count, peak highlight, empty state, total count
- **MyComparisonSection.test.tsx** (7 tests): login CTA, no-data CTA, comparison display, faster/slower styling, meta info, error state
- **InsightsPage.test.tsx** (10 tests): layout, loading skeleton, empty state, error state, region cards, accordion expand, sort, non-auth comparison

## Quality Gates
| Check | Result |
|-------|--------|
| `tsc --noEmit` | 0 errors |
| `eslint --max-warnings=0` | 0 warnings |
| `vite build` | success (950KB precache) |
| `vitest run` | 549 passed (42 files), 37 new |

## Files Changed

### New Files (10)
- `frontend/src/infrastructure/query/use-insights-query.ts`
- `frontend/src/presentation/pages/insights/InsightsPage.tsx`
- `frontend/src/presentation/pages/insights/RegionCard.tsx`
- `frontend/src/presentation/pages/insights/PeakHoursChart.tsx`
- `frontend/src/presentation/pages/insights/MyComparisonSection.tsx`
- `frontend/src/presentation/pages/insights/RegionDetailPanel.tsx`
- `frontend/src/presentation/pages/insights/InsightsPage.test.tsx`
- `frontend/src/presentation/pages/insights/RegionCard.test.tsx`
- `frontend/src/presentation/pages/insights/PeakHoursChart.test.tsx`
- `frontend/src/presentation/pages/insights/MyComparisonSection.test.tsx`
- `frontend/src/presentation/styles/pages/insights.css`

### Modified Files (5)
- `frontend/src/infrastructure/api/commute-api.client.ts` — added insight types + API methods
- `frontend/src/infrastructure/query/query-keys.ts` — added insights keys
- `frontend/src/__mocks__/infrastructure/api/index.ts` — added insight mocks
- `frontend/src/presentation/App.tsx` — added InsightsPage route + preload
- `frontend/src/presentation/components/BottomNavigation.tsx` — added insights tab
- `frontend/src/presentation/styles/index.css` — imported insights.css
