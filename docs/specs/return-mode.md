# Spec â€” P2-4: í‡´ê·¼ ëª¨ë“œ

> Feature: return-mode | Priority: Must | Effort: M

## JTBD

"í‡´ê·¼ ì‹œê°„ì´ ë˜ë©´ ì•±ì´ ìë™ìœ¼ë¡œ ê·€ê°€ ëª¨ë“œë¡œ ë°”ë€Œì–´ì„œ, í‡´ê·¼ ê²½ë¡œ êµí†µ ìƒí™©ê³¼ ì €ë… ë‚ ì”¨ë¥¼ í•œëˆˆì— ë³´ê³  ì‹¶ë‹¤."

## ê¸°ì¡´ ì¸í”„ë¼ ë¶„ì„

P2-2, P2-3ì—ì„œ ì´ë¯¸ êµ¬í˜„ëœ ê²ƒ:
- SmartDepartureCard: `hour < 14 â†’ commute`, `hour >= 14 â†’ return` ìë™ ì „í™˜
- getBriefingContextLabel: 6-12 ì¶œê·¼, 12-21 í‡´ê·¼, 21+ ë‚´ì¼ ì¶œê·¼
- SmartDepartureSetting: `departureType: 'return'` ì§€ì›
- Widget data: departure commute/return í¬í•¨

**ê²°ë¡ **: ë°ì´í„° ë ˆì´ì–´ëŠ” ì™„ë¹„. P2-4ëŠ” UX ë ˆì´ì–´ ê°œì„ ì— ì§‘ì¤‘.

## í•µì‹¬ ë³€ê²½ì‚¬í•­

### 1. useCommuteMode í›… (NEW)
ì‹œê°„ ê¸°ë°˜ ìë™ ëª¨ë“œ + ìˆ˜ë™ ì˜¤ë²„ë¼ì´ë“œ:
- `commute`: 06:00-13:59
- `return`: 14:00-20:59
- `night`: 21:00-05:59 (ë‚´ì¼ ì¶œê·¼ ëŒ€ê¸°)
- ìˆ˜ë™ í† ê¸€ ì‹œ ì„¸ì…˜ ë™ì•ˆ ìœ ì§€ (ì•± ì¬ì‹œì‘ ì‹œ ìë™ ë³µê·€)

### 2. í™ˆ í™”ë©´ ì ì‘í˜• UI
| ìš”ì†Œ | ì¶œê·¼ ëª¨ë“œ | í‡´ê·¼ ëª¨ë“œ |
|------|----------|----------|
| ì¸ì‚¬ë§ | "ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”" | "ì˜¤ëŠ˜ë„ ìˆ˜ê³ í–ˆì–´ìš”" |
| ëª¨ë“œ ë°°ì§€ | ğŸŒ… ì¶œê·¼ ëª¨ë“œ | ğŸŒ† í‡´ê·¼ ëª¨ë“œ |
| ì¹´ë“œ ìˆœì„œ | Briefing â†’ Departure â†’ Weather â†’ Transit | Briefing â†’ Departure â†’ Weather â†’ Transit |
| BriefingCard | ì¶œê·¼ ë¸Œë¦¬í•‘ | í‡´ê·¼ ë¸Œë¦¬í•‘ (ì´ë¯¸ êµ¬í˜„) |
| SmartDepartureCard | ì¶œê·¼ ìŠ¤ëƒ…ìƒ· ìš°ì„  | í‡´ê·¼ ìŠ¤ëƒ…ìƒ· ìš°ì„  (ì´ë¯¸ êµ¬í˜„) |

### 3. ëª¨ë“œ ì „í™˜ í† ê¸€
- í™ˆ í™”ë©´ í—¤ë”ì— ì‘ì€ í† ê¸€ ë²„íŠ¼ (ì¶œê·¼ â†” í‡´ê·¼)
- ì‹œê°„ ê¸°ë°˜ ìë™ ëª¨ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì˜¤ë²„ë¼ì´ë“œ
- ì•± ì¬ì‹œì‘ ì‹œ ìë™ ëª¨ë“œë¡œ ë³µê·€

### 4. Backend: Widget mode íŒŒë¼ë¯¸í„°
`GET /widget/data?mode=commute|return`
- modeì— ë”°ë¼ departure ìš°ì„ ìˆœìœ„ ë³€ê²½
- briefingì˜ timeContext ì˜¤ë²„ë¼ì´ë“œ

## DB Schema

ì—†ìŒ. ëª¨ë“œ ìƒíƒœëŠ” í´ë¼ì´ì–¸íŠ¸ ë©”ëª¨ë¦¬ì—ì„œë§Œ ê´€ë¦¬ (ì„¸ì…˜ ë ˆë²¨).

## API ë³€ê²½

### ê¸°ì¡´ ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
`GET /widget/data`
- ì¶”ê°€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°: `mode?: 'commute' | 'return'`
- ê¸°ë³¸ê°’: ì‹œê°„ ê¸°ë°˜ ìë™ ê°ì§€ (ê¸°ì¡´ ë™ì‘)

## Task Breakdown

### Backend (2 tasks)
- BE-1: Widget data endpointì— mode ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€
- BE-2: BriefingAdviceService.generate()ì— mode ì˜¤ë²„ë¼ì´ë“œ ì§€ì›

### Frontend (5 tasks)
- FE-1: useCommuteMode í›… (ìë™ + ìˆ˜ë™ ëª¨ë“œ)
- FE-2: ModeBadge ì»´í¬ë„ŒíŠ¸ (ì¶œê·¼/í‡´ê·¼ ë°°ì§€ + í† ê¸€)
- FE-3: í™ˆ í™”ë©´ ì¸ì‚¬ë§ ëª¨ë“œ ì ì‘
- FE-4: í™ˆ í™”ë©´ì— ModeBadge + useCommuteMode í†µí•©
- FE-5: TypeScript ê²€ì¦

## Acceptance Criteria

- [ ] AC-1: 14ì‹œ ì´ì „ í™ˆ í™”ë©´ì— "ì¶œê·¼ ëª¨ë“œ" í‘œì‹œ
- [ ] AC-2: 14ì‹œ ì´í›„ í™ˆ í™”ë©´ì— "í‡´ê·¼ ëª¨ë“œ" í‘œì‹œ
- [ ] AC-3: ëª¨ë“œ í† ê¸€ ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ë™ ì „í™˜ ê°€ëŠ¥
- [ ] AC-4: ìˆ˜ë™ ì „í™˜ í›„ ì•± ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€
- [ ] AC-5: ì¸ì‚¬ë§ì´ ëª¨ë“œì— ë”°ë¼ ë³€ê²½
- [ ] AC-6: Backend widget/dataì— mode íŒŒë¼ë¯¸í„° ì§€ì›
- [ ] AC-7: TypeScript 0 errors (BE + Mobile)
- [ ] AC-8: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì „ë¶€ í†µê³¼
