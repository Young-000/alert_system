# Auto E2E Review - 2026-02-23 08:00

## 이전 리뷰
- 파일: `.claude/e2e-reports/auto-review/20260221_080004.md`
- 이전 미해결: 5건 (모두 권고사항)

## 리뷰 결과

| Phase | 상태 | 수정 | 미해결 |
|-------|------|------|--------|
| Phase 1: Build & Lint | ✅ 통과 | 0건 | 0 |
| Phase 2: Security | ✅ 수정 | 1건 (CORS regex) | 0 |
| Phase 3: Performance | ✅ 통과 | 0건 | 1건 (권고) |
| Phase 4: UX 핵심 플로우 | ⚠️ 통과 | 0건 | 3건 (권고) |
| Phase 5: UX 에러 복구 | ⚠️ 통과 | 0건 | 3건 (권고) |
| Phase 6: UX 상태 표시 | ✅ 수정 | 1건 (터치 타겟) | 1건 (권고) |
| Phase 7: DB & 스키마 | ✅ 통과 | 0건 | 0 |
| Phase 8: PWA & 알림 | ✅ 통과 | 0건 | 0 |

## 수정 내역

### Phase 2: CORS regex 수정 (1건)
1. `backend/src/main.ts:45` — Vercel 프리뷰 URL 정규식 패턴 개선. `(-[a-z0-9]+)?` → `(-[a-z0-9]+)*` 으로 변경하여 멀티 세그먼트 브랜치명(예: `frontend-xi-two-52-feature-long-name`) 허용

### Phase 6: 터치 타겟 수정 (1건)
2. `frontend/src/presentation/styles/components.css:1216-1217` — `.input-addon` (비밀번호 토글 등) 크기 36x36px → 44x44px로 증가. Apple HIG 권장 최소 터치 타겟(44px) 충족

## 미해결 이슈

### 이전 리뷰에서 이어받은 권고사항 (변동 없음)
1. **[Phase 2] 알림톡 템플릿 ID 하드코딩** — `solapi.service.ts` 상수 정의. 공개 정보이므로 보안 위험 없음.
2. **[Phase 5] 500 에러 메시지 통칭 처리** — API 클라이언트가 상태코드만 throw, 통칭 메시지 사용.
3. **[Phase 5] 외부 API 실패 시 폴백 부재** — 에러 메시지만 표시, 캐시된 데이터 활용 미흡.
4. **[Phase 5] 새로고침 시 폼 상태 미보존** — sessionStorage 활용 미흡.

### 이번 리뷰 신규 권고사항
5. **[Phase 3] 알림 전송 시 지하철역 N+1 쿼리** — `send-notification.use-case.ts:189-199` 루프 내 순차 `findById()` 호출 (최대 2회). `findByIds()` 배치 메서드 구현 권장.
6. **[Phase 4] 출퇴근 세션 완료 후 자동 리다이렉트 없음** — `CommuteTrackingPage.tsx:217-259` 완료 화면에서 수동 "홈으로" 버튼만 존재. 5~10초 타이머 리다이렉트 권장.
7. **[Phase 5] 체크포인트 기록 실패 시 롤백 없음** — `CommuteTrackingPage.tsx:193-210` `Promise.all()` 부분 실패 시 재시도 메커니즘 부재.
8. **[Phase 6] NotificationHistoryPage 로딩 스켈레톤 부재** — 스피너만 표시, 스켈레톤 플레이스홀더 권장.

## 검증 결과 상세

### Phase 1: Build & Lint ✅
| 항목 | Frontend | Backend |
|------|----------|---------|
| lint | ✅ 0 errors | ✅ 0 errors |
| type-check | ✅ pass | ✅ pass |
| build | ✅ pass | ✅ pass |
| test | ✅ 28 suites, 381 passed | ✅ 62 suites, 675 passed |

### Phase 2: Security ✅
- 인증: JWT + 전역 Guard ✅
- 권한: 모든 엔드포인트 userId 검증 ✅
- 입력검증: DTO + class-validator ✅
- CORS: 화이트리스트 + Vercel 패턴 ✅ (수정됨)
- Helmet: CSP ✅
- Rate Limiting: 전역 60/min + 엔드포인트별 ✅
- SQL Injection: TypeORM parameterized ✅
- 스케줄러: timingSafeEqual ✅
- AllExceptionsFilter: 스택 트레이스 노출 방지 ✅

### Phase 3: Performance ✅
- 번들: gzip ~217KB (500KB 미만) ✅
- 코드 스플리팅: 10개 페이지 모두 lazy + idle preload ✅
- 외부 API 캐싱: 날씨/대기질/버스/지하철 모두 캐시 ✅
- DB 풀링: prod=10, dev=5 커넥션 ✅
- API 재시도: 지수 백오프 (1s, 2s, 3s) ✅

### Phase 4: UX 핵심 플로우 ⚠️
- Flow 1 (회원가입): 완전 구현 ✅
- Flow 2 (경로 설정): 완전 구현 ✅
- Flow 3 (출퇴근): 완전 구현 ⚠️ (완료 후 자동 리다이렉트 없음)
- Flow 4 (알림 설정): 완전 구현 ✅

### Phase 5: 에러 복구 ⚠️
- 오프라인 배너: ✅
- 401 자동 로그아웃: ✅
- 404 페이지: ✅
- 중복 요청 방지: ✅
- 500 에러 처리: ⚠️ 통칭 메시지
- 외부 API 폴백: ⚠️ 메시지만
- 체크포인트 실패 롤백: ⚠️ 부재

### Phase 6: 상태 표시 ✅
- 로딩 (skeleton/spinner): ✅
- 빈 상태 (empty state): ✅
- 에러 + 재시도: ✅
- 성공 피드백 (toast): ✅
- 버튼 상태: ✅
- 모바일 터치: ✅ (input-addon 44px로 수정됨)
- disabled 입력: ✅ (이미 opacity: 0.7 적용)

### Phase 7: DB & 스키마 ✅
- 26/26 엔티티 `alert_system` 스키마 사용 ✅
- public 테이블 없음 ✅
- userId 필터링 전 계층 ✅
- 5개 마이그레이션 적용 ✅
- RLS 정책 auth.uid() 사용 ✅

### Phase 8: PWA & 알림 ✅
- VitePWA + Workbox: ✅
- 오프라인 캐시 (NetworkFirst/CacheFirst/SWR): ✅
- Push 알림 (VAPID): ✅
- EventBridge Scheduler: ✅
- Solapi 알림톡: ✅
- SW 자동 업데이트 (60초): ✅

## 통계
- 총 체크: 48건
- 통과: 40건
- 수정: 2건
- 미해결: 8건 (모두 권고사항)
- **종합 점수: 92/100** (이전 90 → 92, CORS/터치 수정)
