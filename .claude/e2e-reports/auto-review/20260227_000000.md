# Auto E2E Review - 2026-02-27 00:00

## 이전 리뷰
- 파일: `20260226_000000.md`
- 이전 미해결: 5건 (권고사항, 수정 불필요)

## 리뷰 결과

| Phase | 상태 | 수정 | 미해결 |
|-------|------|------|--------|
| Phase 1: Build & Lint | 수정 | 1건 (테스트 실패) | 0 |
| Phase 2: Security | 통과 | 0건 | 0 |
| Phase 3: Performance | 수정 | 1건 (React key) | 0 |
| Phase 4: UX 핵심 플로우 | 통과 | 0건 | 0 |
| Phase 5: UX 에러 복구 | 수정 | 2건 (retry + feedback) | 2 |
| Phase 6: UX 상태 표시 | 통과 | 0건 | 0 |
| Phase 7: DB & 스키마 | 통과 | 0건 | 0 |
| Phase 8: PWA & 알림 | 통과 | 0건 | 0 |

## 수정 내역

### Phase 1: 테스트 실패 수정 (1건)

1. `frontend/src/presentation/pages/home/use-commute-mode.ts:51` — toggleMode에서 night 모드를 처리하지 않아 시간 의존적 테스트 실패. night 모드일 때 return으로 전환되도록 조건문 수정.
   - 변경 전: `return current === 'commute' ? 'return' : 'commute';`
   - 변경 후: `return (current === 'commute' || current === 'night') ? 'return' : 'commute';`

### Phase 3: React key 중복 가능성 수정 (1건)

2. `frontend/src/presentation/pages/report/WeeklyTab.tsx:183`, `MonthlyTab.tsx:182`, `SummaryTab.tsx:142` — insight 리스트에서 서버 문자열을 직접 key로 사용. 중복 insight 문자열 시 React reconciler가 항목을 누락할 수 있음. composite key 패턴으로 변경.

### Phase 5: 에러 복구 개선 (2건)

3. `frontend/src/presentation/pages/report/WeeklyTab.tsx:38-47`, `MonthlyTab.tsx:121-129`, `SummaryTab.tsx:77-85` — 에러 상태에 "다시 시도" 버튼 누락. React Query의 refetch를 활용한 retry 버튼 추가.

4. `frontend/src/presentation/pages/home/use-home-data.ts:219-220` — handleStartCommute catch 블록에서 에러 시 사용자 피드백 없이 네비게이션만 수행. commuteStartError 상태 추가 + HomePage에 에러 배너 표시.

## 미해결 이슈

### 이전 리뷰 권고사항 (변경 없음)

1. **[Phase 2] 알림톡 템플릿 ID 하드코딩** — backend/src/infrastructure/messaging/solapi.service.ts. 7개 템플릿 ID가 코드에 하드코딩됨. 공개 정보이므로 보안 위험 낮음.

2. **[Phase 5] 500 에러 메시지 통칭 처리** — API 클라이언트가 상태코드만 throw하므로 상세 메시지 전달 제한.

3. **[Phase 5] 외부 API 실패 시 폴백 부재** — 날씨/교통 API 실패 시 캐시 데이터 활용 미흡.

4. **[Phase 5] 새로고침 시 폼 상태 미보존** — RouteSetupPage, CommuteTrackingPage에서 sessionStorage 미활용.

5. **[Phase 6] 모바일 터치 타겟** — 일부 아이콘 버튼이 Apple 권장 44px 미만.

### 신규 권고사항

6. **[Phase 5] departure prediction/route recommendation silent failure** — use-home-data.ts:157,174에서 console.warn만 사용. 보조 기능이므로 UI 미표시는 허용되나, CLAUDE.md "silent failure 금지" 원칙과 비일관.

7. **[Phase 8] PWA manifest shortcut에 /reports 미포함** — 리포트 페이지가 주요 네비게이션 대상이면 PWA shortcut 추가 권장.

## 검증 결과 상세

### Frontend
| 항목 | 결과 |
|------|------|
| lint | 에러 0 |
| typecheck | 에러 0 |
| build | gzip ~168KB (제한 500KB) |
| test | 31 suites, 418 passed |

### Backend
| 항목 | 결과 |
|------|------|
| lint | 에러 0 |
| typecheck | 에러 0 |
| build | 성공 |
| test | 75 suites, 892 passed, 10 skipped |

## Phase별 점검 요약

### Phase 1: Build & Lint
- Frontend: ESLint 0 error, TypeScript strict mode 통과, Vite build 성공 (~168KB gzip)
- Backend: ESLint 0 error, TypeScript 통과, NestJS build 성공
- use-commute-mode 테스트 night 모드 처리 버그 수정

### Phase 2: Security
- JWT 인증 + bcrypt + timingSafeEqual
- CORS 화이트리스트
- Helmet CSP
- Rate Limiting (ThrottlerModule 60/min + 로그인 5/min)
- ValidationPipe (whitelist + forbidNonWhitelisted)
- 하드코딩된 시크릿 없음, SSM Parameter Store 사용
- XSS 벡터 없음
- 신규 파일 (report, briefing, streak) 보안 검증 통과

### Phase 3: Performance
- 모든 14개 페이지 lazy loading + idle preload
- API 캐싱: 날씨/미세먼지 1시간, 교통 30초, 리포트 10-15분
- Vite manualChunks 분리 (vendor-react, vendor-router, vendor-query)
- useMemo 적절 사용, 과도한 메모이제이션 없음
- 번들 사이즈: ~168KB gzip (500KB 제한 이내)
- React key 중복 가능성 수정 (insight 리스트)

### Phase 4: UX 핵심 플로우
- HomePage: 로그인/비로그인 분기 명확, Quick action 동작, Evening mode 전환
- ReportPage: 탭 전환 (weekly/monthly/summary), 인증 보호, 데이터 로딩
- Mission: 체크인 플로우, 설정 CRUD, 삭제 확인 다이얼로그
- JSX 조건부 렌더링: 모순 조건 없음, 명확 분리

### Phase 5: UX 에러 복구
- API 401: 글로벌 감지 + 로그인 페이지 리다이렉트
- 네트워크 에러: withRetry 3회 + 지수 백오프
- HomePage loadError: 재시도 버튼
- Report 탭 에러: 재시도 버튼 추가 (이번 리뷰)
- handleStartCommute: 에러 피드백 추가 (이번 리뷰)

### Phase 6: UX 상태 표시
- 로딩 상태: 모든 페이지에서 스켈레톤/스피너 표시
- 빈 상태: EmptyState 컴포넌트 + 안내 메시지 + CTA
- 에러 상태: role="alert" 30곳 적용, 명시적 에러 메시지
- 버튼 상태: disabled/loading 적절 표시

### Phase 7: DB & Schema
- 모든 32개 TypeORM 엔티티에서 alert_system 스키마 사용
- public 스키마 사용 없음
- seed SQL 전체 alert_system prefix 사용
- 미션 관련 신규 엔티티 모두 스키마 지정 확인

### Phase 8: PWA & Notifications
- VitePWA injectManifest 모드
- 서비스 워커 캐싱 전략 (StaleWhileRevalidate, CacheFirst, NetworkFirst)
- VAPID 푸시 알림
- EventBridge Scheduler 영구 스케줄
- Solapi 알림톡 7개 템플릿
- 신규 /reports 라우트 빌드 아티팩트에 포함

## 신규 코드 리뷰 (#78-#82)

이전 리뷰(2026-02-26) 이후 5개 커밋이 추가됨. 주요 변경:
- #78: missions response unwrap 수정
- #79: context-aware advice chips (BriefingSection)
- #80: evening mode with auto time-based switching
- #81: milestone badges + badge collection panel (StreakBadge)
- #82: dedicated report page with weekly/monthly/summary tabs

신규 코드 품질:
- React Query 적절 사용 (staleTime 10-15분, refetchOnWindowFocus 설정)
- 접근성: role="tablist/tab/tabpanel", aria-selected, aria-label, role="progressbar"
- 로딩/에러/빈 상태 모두 처리 (각 탭 독립 스켈레톤)
- memo 적절 사용 (StreakBadge)
- 순수 함수 분리 (buildBriefing, getAutoMode, getTimeContext)

## 통계
- 총 체크: ~85건 / 통과: 81건 / 수정: 4건 / 미해결: 7건 (권고사항)
