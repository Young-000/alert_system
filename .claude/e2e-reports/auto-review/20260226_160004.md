# Auto E2E Review - 2026-02-26 16:00

## 이전 리뷰
- 파일: (첫 자동 리뷰)
- 이전 미해결: 0건

## 리뷰 결과

| Phase | 상태 | 수정 | 미해결 |
|-------|------|------|--------|
| Phase 1: Build & Lint | ✅ PASS | 0 | 0 |
| Phase 2: Security | ⚠️ | 1 | 4 |
| Phase 3: Performance | ✅ PASS | 0 | 0 |
| Phase 4: UX 핵심 플로우 | ⚠️ | 1 | 5 |
| Phase 5: UX 에러 복구 | ⚠️ | 2 | 3 |
| Phase 6: UX 상태 표시 | ⚠️ | 2 | 0 |
| Phase 7: DB & 스키마 | ⚠️ | 0 | 1 |
| Phase 8: PWA & 알림 | ✅ PASS | 0 | 0 |

## 수정 내역

1. **[backend] scheduler-trigger.controller.ts:17-21 + scheduler-trigger.dto.ts (신규)**
   - `SchedulerTriggerPayload` interface → `SchedulerTriggerDto` class 변환
   - `@IsUUID`, `@IsArray`, `@IsString`, `@ArrayMinSize(1)` 검증 데코레이터 추가
   - EventBridge에서 호출되는 엔드포인트의 입력 검증 강화 (Security 2-3)

2. **[frontend] RouteSetupPage.tsx:218**
   - 체크포인트 최소 유지 수: `1` → `2`로 수정
   - 에러 메시지: "경유지는 최소 1개 필요합니다" → "경유지는 최소 2개 필요합니다"
   - CLAUDE.md 스펙과 코드 일치시킴 (UX 4-2-5)

3. **[frontend] RouteSetupPage.tsx:111-147 + 522-536**
   - 로딩 로직을 `loadRoutes` 함수로 추출, `loadError` 상태 추가
   - 로딩 실패 시 에러 메시지 + "다시 시도" 재시도 버튼 UI 추가 (UX 5-2, 6-3)

4. **[frontend] use-alert-crud.ts + AlertSettingsPage.tsx:306-315**
   - `useAlertCrud`에 `loadError`, `retryLoad` 반환값 추가
   - AlertSettingsPage에 로딩 에러 시 재시도 UI 추가 (UX 5-2, 6-3)

5. **[frontend] RouteSetupPage.test.tsx:491-512**
   - 에러 로딩 테스트를 새 UI에 맞게 업데이트
   - "경로가 없어요" → "경로 목록을 불러올 수 없습니다" + "다시 시도" 버튼 검증

## 미해결 이슈

### Security (4건)
1. **[S-1] RLS 미적용 테이블 17개** — `notification_logs`, `challenge_templates`, `user_challenges`, `user_badges`, `missions`, `daily_mission_records`, `mission_scores` 등. SQL migration 파일 작성 필요. 백엔드가 서비스 키로 접근하므로 즉각 위험은 낮음.
2. **[S-2] Public 엔드포인트 외부 API 비용 노출** — `/bus/*`, `/subway/*`, `/weather/*`가 인증 없이 접근 가능. 분산 공격 시 외부 API 비용/할당량 소진 위험. IP 기반 Rate Limiting 추가 권장.
3. **[S-3] JWT 7일 만료 + Refresh Token 부재** — Access Token만 사용, 탈취 시 7일간 유효. Refresh Token 메커니즘 도입 권장.
4. **[S-4] Google OAuth FRONTEND_URL 폴백** — `FRONTEND_URL` 미설정 시 `http://localhost:5173`으로 폴백. 프로덕션에서 open redirect 가능성 (낮음).

### UX (5건)
5. **[U-1] 스톱워치 모드 라우팅 미구현** — `/commute?mode=stopwatch` 파라미터를 `CommuteTrackingPage`가 처리하지 않음. 온보딩에서 링크는 있으나 실제 동작 안 함.
6. **[U-2] 경로 저장 후 `/commute` 대신 `/` 이동** — 스펙은 `/commute`로 리다이렉트이나 코드는 홈(`/`)으로 이동. 의도적 설계일 수 있어 미수정.
7. **[U-3] 체크포인트별 개별 도착 기록 불가** — 완료 시 미기록 체크포인트 일괄 자동 기록. 개별 도착 버튼 미구현.
8. **[U-4] 온보딩 완료 후 자동 리다이렉트 없음** — complete 단계에서 수동 버튼 클릭 필요.
9. **[U-5] 로그인 폼 필드 레벨 에러 미표시** — 폼 전체 에러만 표시, 개별 필드 인라인 에러 없음.

### DB (1건)
10. **[D-1] Migration SQL 미작성 12+ 테이블** — TypeORM entity에는 있으나 SQL migration 파일이 없음. 프로덕션 `synchronize: false` 시 테이블 자동 생성 안 됨.

## Phase별 상세

### Phase 1: Build & Lint ✅
- Frontend: lint ✅, type-check ✅, build ✅ (gzip 225KB), 31 files / 418 tests ✅
- Backend: lint ✅, build ✅, 75 suites / 892 tests ✅ (3 skipped)

### Phase 2: Security ⚠️
| # | 항목 | 상태 | 상세 |
|---|------|------|------|
| 2-1 | 환경변수 노출 | ✅ | .env gitignore, 하드코딩 없음 |
| 2-2 | API 인증 | ✅ | 전역 JWT Guard + @Public 명시적 예외 |
| 2-3 | 입력 검증 | ✅ (수정) | SchedulerTriggerPayload DTO 검증 추가 |
| 2-4 | CORS 설정 | ✅ | 명시적 허용 목록, wildcard 없음 |
| 2-5 | Supabase RLS | ⚠️ | 기존 15개 테이블 ✅, 신규 17개 테이블 미적용 |

### Phase 3: Performance ✅
| # | 항목 | 상태 | 상세 |
|---|------|------|------|
| 3-1 | 번들 사이즈 | ✅ | gzip 225KB (목표 500KB 이내) |
| 3-2 | 코드 스플리팅 | ✅ | 12개 페이지 lazy loading + 유휴 시간 사전로드 |
| 3-3 | N+1 쿼리 | ✅ | TypeORM relations 명시적 eager loading |
| 3-4 | 외부 API 캐싱 | ✅ | ApiCacheService (날씨 1h, 교통 30s) |
| 3-5 | 이미지 최적화 | ✅ | SVG 인라인, PWA 아이콘만 사용 |

### Phase 4: UX 핵심 플로우 ⚠️
- Flow 1 (회원가입→온보딩): 4/4 항목 ✅ (온보딩 자동 리다이렉트 없음은 경미)
- Flow 2 (경로 설정): 6/8 항목 ✅, 체크포인트 최소 수정 ✅, 저장 후 리다이렉트 ⚠️
- Flow 3 (출퇴근 트래킹): 3/5 항목 ✅, 스톱워치 모드 ⚠️, 개별 체크포인트 ⚠️
- Flow 4 (알림 설정): 4/4 항목 ✅

### Phase 5: UX 에러 복구 ⚠️
| # | 항목 | 상태 |
|---|------|------|
| 5-1 | 네트워크 끊김 | ✅ OfflineBanner + useOnlineStatus |
| 5-2 | API 500 에러 | ✅ (수정) 재시도 버튼 추가 |
| 5-3 | 인증 만료 | ✅ 401 시 자동 로그아웃 + 리다이렉트 |
| 5-4 | 404 페이지 | ✅ NotFoundPage 구현 |
| 5-5 | 외부 API 실패 | ⚠️ 폴백 메시지 있으나 재시도 없음 |
| 5-6 | 폼 유효성 | ⚠️ 폼 레벨 에러만, 필드별 에러 없음 |
| 5-7 | 중복 요청 방지 | ✅ 버튼 disabled 처리 |
| 5-8 | 뒤로가기/새로고침 | ⚠️ 세션은 복구 가능, 폼은 소실 |

### Phase 6: UX 상태 표시 ⚠️→✅ (수정 후)
| # | 항목 | 상태 |
|---|------|------|
| 6-1 | 로딩 상태 | ✅ 스켈레톤/스피너 전반 구현 |
| 6-2 | 빈 상태 | ✅ EmptyState 공통 컴포넌트 + CTA |
| 6-3 | 에러 상태 | ✅ (수정) RouteSetup/AlertSettings 재시도 추가 |
| 6-4 | 성공 피드백 | ✅ Toast 시스템 (4타입, 자동소멸) |
| 6-5 | 버튼 상태 | ✅ enabled/disabled/loading 구분 |
| 6-6 | 모바일 터치 | ✅ min-height: 44px 전역 |

### Phase 7: DB & 스키마 ⚠️
| # | 항목 | 상태 |
|---|------|------|
| 7-1 | 스키마 사용 | ✅ 32개 entity 모두 `alert_system` 스키마 |
| 7-2 | public 테이블 | ✅ public 스키마 앱 테이블 없음 |
| 7-3 | RLS 정책 | ✅ 기존 migration의 14개 테이블 RLS 활성화 |
| 7-4 | 마이그레이션 | ⚠️ 12+ 신규 entity에 SQL migration 없음 |

### Phase 8: PWA & 알림 ✅
| # | 항목 | 상태 |
|---|------|------|
| 8-1 | Service Worker | ✅ VitePWA injectManifest, Workbox |
| 8-2 | 오프라인 모드 | ✅ NetworkFirst + precache fallback |
| 8-3 | Push 알림 | ✅ VAPID 구독 + SW push 핸들러 |
| 8-4 | EventBridge | ✅ Create/Update/Delete 구현 완료 |
| 8-5 | Solapi 알림톡 | ✅ 6종 템플릿 정의 (주간 리포트는 TODO) |

## 통계
- 총 체크: 42건
- 통과: 32건
- 수정: 5건 (파일 6개 수정/생성)
- 미해결: 10건 (Security 4, UX 5, DB 1)

## 수정 후 검증 결과
- Frontend: lint ✅, type-check ✅, build ✅, 31 files / 418 tests ✅
- Backend: lint ✅, type-check ✅, build ✅, 75 suites / 892 tests ✅
