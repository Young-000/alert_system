# E2E Auto Review Report

- **Date**: 2026-02-27
- **Branch**: feature/e2e-auto-review-20260227
- **Reviewer**: Claude Opus 4.6

---

## Summary

| Category | Status | Details |
|----------|--------|---------|
| ESLint (FE) | PASS | 0 errors, 0 warnings |
| ESLint (BE) | PASS | 0 errors, 0 warnings |
| TypeScript (FE) | PASS | tsc --noEmit clean |
| TypeScript (BE) | PASS | tsc --noEmit clean |
| Build (FE) | PASS | Vite build, 883KB precache, vendor-react 142KB |
| Build (BE) | PASS | NestJS build clean |
| Tests (FE) | PASS | 418 passed, 31 suites |
| Tests (BE) | PASS | 892 passed, 10 skipped, 75/78 suites |
| Security | PASS (with notes) | 2 medium, 2 low findings |
| Frontend Review | 4 issues found | 2 high, 2 medium - 3 fixed |
| Backend Review | PASS | Clean architecture maintained |
| UX Patterns | PASS | Loading/error/empty states present |

**Total issues found: 8 | Fixed: 3 | Unresolved: 5 (accepted risk)**

---

## Phase 1: Code Quality

### ESLint
- **Frontend**: PASS - 0 errors
- **Backend**: PASS - 0 errors (ESLint v8.57.1 with .eslintrc.js)

### TypeScript
- **Frontend**: PASS - strict mode, no errors
- **Backend**: PASS - strict mode, no errors

### Build
- **Frontend**: PASS - Vite 5.4.21, 883KB precache
  - vendor-react: 142KB (gzip 45KB)
  - RouteSetupPage: 84KB (largest page chunk)
  - HomePage: 48KB
- **Backend**: PASS - NestJS clean build

---

## Phase 2: Tests

### Backend (Jest)
- **892 passed**, 10 skipped, 75/78 suites
- 3 suites skipped (integration tests requiring external services)
- Coverage: business logic well-covered

### Frontend (Vitest)
- **418 passed**, 31 suites
- All suites pass
- Components, hooks, utilities covered

---

## Phase 3: Code Review

### Security Review

| Item | Status | Severity | Detail |
|------|--------|----------|--------|
| JWT Global Guard | PASS | - | JwtAuthGuard + @Public() decorator pattern |
| ValidationPipe | PASS | - | Global whitelist + forbidNonWhitelisted |
| Helmet CSP | PASS | - | Proper Content-Security-Policy headers |
| CORS | PASS | - | Configured with allowed origins |
| Rate Limiting | PASS | - | ThrottlerModule enabled |
| SQL Injection | PASS | - | TypeORM parameterized queries throughout |
| Password Hashing | PASS | - | bcrypt with timing-safe comparison |
| Swagger in Prod | PASS | - | Disabled when NODE_ENV=production |
| DevController | PASS | - | Protected behind NODE_ENV check |
| JWT token expiry | NOTE | Medium | 7d expiry without refresh token rotation |
| Public API endpoints | NOTE | Medium | Weather/Subway/Bus APIs use @Public() without rate limit per-user |
| DTO validation | NOTE | Low | Some controllers (behavior, challenge) use interface instead of class-based DTOs |
| .env.production | NOTE | Low | Committed but contains only VAPID public key (non-secret) |

### Frontend Review

| # | File | Severity | Issue | Status |
|---|------|----------|-------|--------|
| 1 | NotificationHistoryPage.tsx:157 | High | Stale closure - `periodFilter` used inside useEffect but omitted from deps (eslint-disable) | **FIXED** |
| 2 | use-alert-crud.ts:154,222 | High | setTimeout callbacks update state without unmount guard | **FIXED** |
| 3 | HomePage.tsx:32 | Medium | eslint-disable-line on useEffect dependency | Accepted (intentional - data object recreated each render) |
| 4 | CommuteDashboardPage.tsx:144-150 | Medium | Stopwatch/analytics tabs render blank when no data | **FIXED** |

### Backend Review

- Clean Architecture layers maintained (domain/application/infrastructure/presentation)
- TypeORM entities properly configured
- Service layer uses dependency injection correctly
- EventBridge scheduler integration is robust with error handling
- No critical issues found

---

## Phase 4: UX Verification

### Loading States
| Page | Status | Pattern |
|------|--------|---------|
| HomePage | PASS | Skeleton cards |
| MissionsPage | PASS | Skeleton shimmer |
| AlertSettingsPage | PASS | Spinner + "서버에 연결 중" |
| CommuteDashboardPage | PASS | Spinner |
| NotificationHistoryPage | PASS | Spinner |
| RouteSetupPage | PASS | Loading indicator |

### Error States
| Page | Status | Pattern |
|------|--------|---------|
| HomePage | PASS | Error notice + retry button |
| MissionsPage | PASS | Error notice + retry button |
| AlertSettingsPage | PASS | Error banner + dismiss |
| CommuteDashboardPage | PASS | Error notice + retry |
| NotificationHistoryPage | PASS | Error banner + retry + dismiss |

### Empty States
| Page | Status | Pattern |
|------|--------|---------|
| HomePage (guest) | PASS | GuestLanding component |
| MissionsPage | PASS | EmptyState component |
| AlertSettingsPage | PASS | Wizard auto-shows |
| CommuteDashboardPage | PASS | EmptyState + action link |
| CommuteDashboardPage (stopwatch tab) | **FIXED** | Added empty state message + action link |
| CommuteDashboardPage (analytics tab) | **FIXED** | Added empty state message |
| NotificationHistoryPage | PASS | Empty state + action link |

### Auth Guard
| Page | Status | Pattern |
|------|--------|---------|
| All protected pages | PASS | AuthRequired component with icon + description |
| OnboardingPage | PASS | Redirects to /login |

### Silent Failures
- No empty catch blocks found
- All catch blocks either set error state or re-throw

---

## Fixes Applied

### Fix 1: NotificationHistoryPage.tsx - Stale closure removal
**File**: `frontend/src/presentation/pages/NotificationHistoryPage.tsx`
**Change**: Replaced `PERIOD_DAYS[periodFilter]` with `0` in the initial useEffect, removed `eslint-disable-line`. The initial load always uses 'all' period (0 days = no limit), and a separate useEffect handles period filter changes.

### Fix 2: use-alert-crud.ts - setTimeout unmount guard
**File**: `frontend/src/presentation/pages/alert-settings/use-alert-crud.ts`
**Change**: Added `mountedRef` with cleanup effect. Guarded `setSuccess('')` calls in setTimeout callbacks with `mountedRef.current` check to prevent state updates after unmount.

### Fix 3: CommuteDashboardPage.tsx - Empty state for tabs
**File**: `frontend/src/presentation/pages/CommuteDashboardPage.tsx`
**Change**: Added empty state UI for stopwatch and analytics tabs when no data is available, preventing blank content areas.

---

## Unresolved Items (Accepted Risk)

1. **JWT 7d expiry without refresh token** - Medium risk. Requires backend architecture change. Tracked for future sprint.
2. **Public API endpoints** - Medium risk. Weather/Subway/Bus APIs are public by design (no user data exposed). Rate limiting is applied globally.
3. **Interface-based DTOs** - Low risk. Some newer controllers use TypeScript interfaces instead of class-validator DTOs. Works correctly but misses runtime validation.
4. **.env.production committed** - Low risk. Contains only VAPID public key which is intentionally public.
5. **HomePage eslint-disable** - Medium. Intentional pattern - `data` object is recreated each render, adding to deps would cause infinite loop. The `setForceRouteType` setter is stable but accessed through unstable `data` object.

---

## Post-Fix Verification

| Check | Status |
|-------|--------|
| TypeScript (FE) | PASS |
| Build (FE) | PASS |
| Tests (FE) 418/418 | PASS |
| No regressions | PASS |
