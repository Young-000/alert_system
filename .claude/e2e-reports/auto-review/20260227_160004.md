# E2E Auto-Review Report

| 항목 | 값 |
|------|-----|
| **실행일시** | 2026-02-27 16:00 KST |
| **브랜치** | `feature/e2e-auto-review-20260227` |
| **프로젝트** | alert_system (Frontend + Backend) |

---

## 1. Build / Lint / TypeCheck

| 검사 | Frontend | Backend |
|------|:--------:|:-------:|
| TypeCheck | PASS | PASS |
| Lint | PASS | PASS |
| Build | PASS | PASS |

---

## 2. 테스트 결과

| 영역 | Files | Tests | Passed | Failed | Skipped |
|------|------:|------:|-------:|-------:|--------:|
| Frontend (Vitest) | 31 | 418 | 418 | 0 | 0 |
| Backend (Jest) | 78 | 902 | 892 | 0 | 10 |
| **합계** | **109** | **1,320** | **1,310** | **0** | **10** |

---

## 3. 발견된 이슈 (총 20건)

### Frontend (7건)

| # | 파일 | 이슈 | 심각도 | 수정 |
|---|------|------|:------:|:----:|
| FE-1 | `HomePage.tsx:32` | useEffect 의존성 eslint-disable 억제 | Medium | FIXED |
| FE-2 | `NotificationHistoryPage.tsx:157` | useEffect 의존성 억제 + fragile isInitialMount 패턴 | Medium | FIXED |
| FE-3 | `SmartDepartureTab.tsx:96,109,114,119` | `alert()`/`window.confirm()` 사용 (UX 불량) | Medium | FIXED |
| FE-4 | `SmartDepartureTab.tsx:202` | `parseInt` radix 누락 | Low | FIXED |
| FE-5 | `MissionsPage.tsx:80` | `div role="checkbox"` — native `<input>` 권장 | Low | SKIPPED |
| FE-6 | `SmartDepartureTab.tsx:28` | `SettingCard` 반환 타입 누락 | Low | FIXED |
| FE-7 | `EditAlertModal.tsx:26` | Overlay 클릭이 저장 중에도 모달 닫음 | Medium | FIXED |

### Backend (13건)

| # | 파일 | 이슈 | 심각도 | 수정 |
|---|------|------|:------:|:----:|
| BE-1 | `scheduler-trigger.controller.ts:63,113` | timing-safe 비교 길이 사전 체크로 무력화 | High | FIXED |
| BE-2 | `scheduler-trigger.controller.ts:17-21` | `SchedulerTriggerPayload` interface → class 검증 부재 | Medium | SKIPPED |
| BE-3 | `analytics.controller.ts:144,148` | `throw new Error()` → 500 반환 (400이어야 함) | High | FIXED |
| BE-4 | `dev.controller.ts:23` | `throw new Error()` → 500 반환 (403이어야 함) | Medium | FIXED |
| BE-5 | `briefing.controller.ts:13-16` | `BriefingQueryDto` validation decorator 없음 | Medium | SKIPPED |
| BE-6 | `behavior.controller.ts:34-48` | inline interface → ValidationPipe 우회 | Medium | SKIPPED |
| BE-7 | `challenge.controller.ts:87` | inline body 객체 → ValidationPipe 우회 | Medium | SKIPPED |
| BE-8 | `behavior.controller.ts:122` | inline body 객체 → ValidationPipe 우회 | Low | SKIPPED |
| BE-9 | 다수 컨트롤러 | `parseInt` NaN 미처리 (query params) | Medium | FIXED |
| BE-10 | `scheduler-trigger.controller.ts:150` | health 엔드포인트 인증 없음 (의도적일 수 있음) | Low | SKIPPED |
| BE-11 | `commute-route.repository.ts:87-100` | checkpoint 업데이트 트랜잭션 부재 | Medium | SKIPPED |
| BE-12 | `send-notification.use-case.ts:90-95` | solapiService null 시 silent failure | High | FIXED |
| BE-13 | `widget.controller.ts:14` | 반환 타입 누락 | Low | FIXED |

---

## 4. 수정 내역 (총 11건)

### Fix 1: `analytics.controller.ts` — Error → BadRequestException
- `throw new Error(...)` → `throw new BadRequestException(...)` (line 144, 148)
- HTTP 500 → 400으로 올바른 상태 코드 반환

### Fix 2: `dev.controller.ts` — Error → ForbiddenException
- `assertNotProduction()` 에서 `throw new Error()` → `throw new ForbiddenException()`
- HTTP 500 → 403으로 올바른 상태 코드 반환

### Fix 3: `scheduler-trigger.controller.ts` — timing-safe 비교 수정
- 두 메서드(`triggerNotification`, `triggerWeeklyReport`) 모두 수정
- `timingSafeEqual`이 길이 불일치 시 throw하는 동작 → try-catch로 안전 처리
- 길이 사전 비교로 인한 타이밍 누출 방지

### Fix 4: `send-notification.use-case.ts` — silent failure 로깅
- `solapiService` null과 `phoneNumber` 없음을 별도 체크로 분리
- 각 경우에 명시적 warn 로그 추가

### Fix 5: `SmartDepartureTab.tsx` — alert/confirm → useToast + 확인 모달
- `alert()`, `window.confirm()` 제거
- `useToast` 훅 + `ToastContainer` 적용
- 삭제 확인에 커스텀 모달 UI 사용

### Fix 6: `EditAlertModal.tsx` — 저장 중 overlay 클릭 보호
- `onClick={onCancel}` → `onClick={isEditing ? undefined : onCancel}`

### Fix 7: `NotificationHistoryPage.tsx` — useEffect 정리
- `isInitialMount` ref 패턴 + eslint-disable 제거
- useEffect 2개로 분리 (history / stats)

### Fix 8: `HomePage.tsx` — useEffect 의존성 정리
- `eslint-disable-line react-hooks/exhaustive-deps` 제거
- `setForceRouteType` 디스트럭처링 후 의존성 배열에 추가

### Fix 9: 다수 Backend 컨트롤러 — parseInt NaN 방지
- `commute.controller.ts`: limit, offset, days, weekOffset 4곳
- `behavior.controller.ts`: limit 1곳
- `commute-event.controller.ts`: limit 1곳
- `analytics.controller.ts`: limit 1곳
- 패턴: `Math.max(min, parseInt(value || '', 10) || default)`

### Fix 10: `widget.controller.ts` — 반환 타입 추가
- `getData()` 메서드에 `Promise<WidgetDataResponseDto>` 타입 명시

### Fix 11: `commute.controller.spec.ts` — 테스트 기대값 수정
- parseInt NaN 방지 수정에 맞춰 테스트 기대값 `NaN` → 기본값 `20, 0`으로 변경

---

## 5. 미수정 이슈 (10건) — 수동 검토 권장

| # | 이유 | 권장 조치 |
|---|------|----------|
| FE-5 | 구조적 HTML 변경 (접근성) | `<input type="checkbox">` + label로 리팩토링 |
| BE-2 | interface → class 전환 (대규모 변경) | DTO class + class-validator 데코레이터 |
| BE-5 | DTO에 validation 데코레이터 추가 필요 | `@IsOptional()`, `@IsNumber()` 등 추가 |
| BE-6 | inline interface → 별도 DTO class | class-validator 적용된 DTO로 전환 |
| BE-7 | inline body → 별도 DTO class | class-validator 적용된 DTO로 전환 |
| BE-8 | inline body → 별도 DTO class | class-validator 적용된 DTO로 전환 |
| BE-10 | 의도적 설계일 수 있음 (EventBridge healthcheck) | 필요시 인증 추가 |
| BE-11 | 트랜잭션 래핑 필요 (구조적 변경) | TypeORM QueryRunner 트랜잭션 사용 |

---

## 6. 검증 결과 (수정 후)

| 검사 | Frontend | Backend |
|------|:--------:|:-------:|
| TypeCheck | PASS | PASS |
| Lint | PASS | PASS |
| Build | PASS | PASS |
| Tests | 418/418 | 892/892 (10 skipped) |

**모든 검증 통과. 기존 테스트 1건 업데이트 (NaN → 기본값 기대값 수정).**

---

## 7. 요약

| 항목 | 값 |
|------|-----|
| 발견 이슈 | 20건 (FE 7 + BE 13) |
| 자동 수정 | 11건 |
| 미수정 (수동 필요) | 10건 |
| 테스트 수정 | 1건 |
| 빌드/테스트 | ALL PASS |
